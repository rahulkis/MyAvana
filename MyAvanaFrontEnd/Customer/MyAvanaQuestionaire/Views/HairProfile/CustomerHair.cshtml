@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper AuthoringTagHelpers.TagHelpers.EmailTagHelper, AuthoringTagHelpers
@using Microsoft.AspNetCore.Http
@*@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor*@
@model MyAvanaQuestionaireModel.HairProfileCustomerModel
@inject MyAvanaQuestionaireApiClient.ApiClient apiClient
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    Layout = "_Layout";
    var hairProfileId = HttpContextAccessor.HttpContext.Request.Query["HairProfileId"];
}

<link href="~/css/styleCustomer.css" rel="stylesheet" />
<link href="~/css/owl.carousel.min.css" rel="stylesheet" />
<link href="~/css/owl.theme.default.css" rel="stylesheet" />
<link href="~/css/jquery.nailthumb.1.1.min.css" rel="stylesheet" type="text/css">
<script src="~/js/shadowbox.js"></script>
<script src="~/js/jquery.nailthumb.1.1.min.js"></script>

<link href="~/css/shadowbox.css" rel="stylesheet" />


<style>

    .alert-success, .alert-danger, .alert-info {
        top: 110px !important;
        width: 60% !important;
        margin: 0 auto;
        z-index: 99;
        position: fixed;
        left: 50%;
        transform: translateX(-40%);
        text-align: center;
        padding: 12px;
        transition: all 1s linear;
        box-shadow: 0px 0px 12px 3px rgba(0, 0, 0, 0.2);
        font-size: 16px;
    }

    .txtFormat {
        white-space: pre-line;
        white-space: pre-wrap;
        border: none;
    }

        .txtFormat:focus {
            outline: none;
        }

    .alert-danger {
        color: #80172a;
        background-color: #fdd5dc;
        border-color: #fcc4ce;
    }

        .alert-danger hr {
            border-top-color: #fbacba;
        }

        .alert-danger .alert-link {
            color: #550f1c;
        }

    .alert-success {
        color: #1c6356;
        background-color: #a8ffc3;
        border-color: #13b755;
    }

        .alert-success hr {
            border-top-color: #b4e7dd;
        }

        .alert-success .alert-link {
            color: #113b33;
        }

    .select2-container, .select2-container li.select2-search {
        width: 100% !important;
    }

    .preloader {
        width: 100%;
        height: 100%;
        top: 0px;
        position: fixed;
        z-index: 99999;
        background: rgba(255, 255, 255, .8);
    }

        .preloader img {
            position: absolute;
            LEFT: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
        }

    .loader {
        overflow: visible;
        padding-top: 2em;
        height: 0;
        width: 2em;
    }

    .centertextdiv {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: calc(100% - 80px);
    }

        .centertextdiv a {
            background: #ffdede;
            padding: 7px 15px;
            color: #383838;
            border-radius: 4px;
            border: 1px solid #ffbaba;
            text-transform: uppercase;
        }

            .centertextdiv a:hover {
                background: #383838;
                color: #ffdede;
                border: 1px solid #ffdede;
            }

        .centertextdiv p {
            font-size: 16px;
            margin-bottom: 30px;
        }

    .accordion-toggle:after {
        font-family: 'FontAwesome';
        content: "\f078";
        float: right;
    }

    .accordion-opened .accordion-toggle:after {
        content: "\f054";
    }

    #accordion2 .accordion-heading {
        padding: 6px 15px;
        margin-bottom: 5px;
        border-radius: 4px;
    }

    .products_tab .nav-link.active {
        background: #756966;
    }

    .products_tab .nav-link {
        color: #756966;
    }

        .products_tab .nav-link:hover {
            background: #756966;
            color: #fff;
        }

    .listhead {
        border-bottom: 1px solid #ccc;
        padding-bottom: 5px;
        margin-bottom: 20px;
    }

    .boservationsubparts {
        display: flex;
        align-items: baseline;
    }

        .boservationsubparts h4 {
            width: 30%;
            text-align: right;
        }

    .Observations .boservationsubparts p {
        background: #ffefee;
        padding: 10px 15px;
        border-radius: 4px;
        margin-left: 10px;
    }

    .Porositynelasticity {
        border-top: 1px solid #ccc;
        padding-top: 20px;
        margin-top: 20px;
    }

    .stylistcrousel .hairsteps {
        box-shadow: 0 1px 6px 0 rgba(32, 33, 36, .28);
        left: 0;
        padding: 15px;
        border-radius: 4px;
        background: #eee;
    }

        .stylistcrousel .hairsteps p {
            word-break: break-word;
        }

    .textFormat {
        white-space: pre-wrap;
    }

    .table-id-data th {
        width: 90px;
    }

    .demo {
        width: 150px;
        height: 150px;
        background-position: center center;
        background-repeat: no-repeat;
        display: inline-block;
    }

    .tab-section {
        padding: 20px 0;
    }

        .tab-section .nav-pills .nav-link.active {
            background: #E9C6C6;
            color: #383838;
            font-weight: bold;
        }

        .tab-section .nav-pills .nav-link {
            color: #707070;
            font-size: 18px;
            position: relative;
            border: none;
            width: 19%;
            /*background: #d8d9e3;*/
            margin-left: 1%;
            border-radius: 3px;
            text-align: center;
            line-height: normal;
            padding: 10px;
            min-height: 58px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
        }

            .tab-section .nav-pills .nav-link:first-child {
                margin-left: 0;
            }

    /*.tab-section .nav-pills .nav-link.active:after {
                content: "";
                position: absolute;
                bottom: -7px;
                left: 50%;
                transform: translateX(-50%);
                width: 0;
                height: 0;
                border-left: 7px solid transparent;
                border-right: 7px solid transparent;
                border-top: 7px solid #6d7071;
                background: transparent;
            }*/
    @@media screen and (max-width:767px) {
        .tab-section .nav-pills .nav-link {
            width: calc(50% - 10px);
            margin: 5px;
            font-size: 16px;
        }
    }

    .products_tab .nav .nav-link {
        width: 100%;
        margin-bottom: 15px;
    }

        .products_tab .nav .nav-link.active:after {
            content: "";
            position: absolute;
            top: 50%;
            left: auto;
            right: -10px;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-top: 7px solid #6d7071;
            background: transparent;
            transform: rotate( -90deg );
        }

    .hair_analyst_notes {
        border: 1px solid #d8dfeb;
        padding: 10px;
        height: 100px;
        overflow: auto;
    }

    @@media screen and (max-width:767px) {
        .tab-section .nav-pills .nav-link {
            width: calc(50% - 10px);
            margin: 5px;
            font-size: 16px;
        }
    }
</style>

<style type="text/css" media="screen">
    .demo {
        width: 150px;
        height: 150px;
        background-position: center center;
        background-repeat: no-repeat;
        display: inline-block;
    }
</style>
<div id="alert-success" class="alert alert-success alert-dismissible" style="display:none; width:50%" data-keyboard="false" data-backdrop="static">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <span id="successMessage"></span>
</div>
<div class="alert alert-danger alert-dismissible" style="display:none; width:50%" data-keyboard="false" data-backdrop="static">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <span id="failureMessage"></span>
</div>

<div class="preloader" style="display:none;">
    <div class="loader">
        <img src="~/images/loader.gif" />
    </div>
</div>
@if (Model == null)
{
    @if (ViewBag.IsExist)
    {
        <div class="centertextdiv">
            <p> Thank you for completing your digital hair assessment. If you have purchased our HairKit and mailed this back to us, your hair profile will be ready soon! </p>

        </div>
    }
    else
    {
        <div class="centertextdiv">
            <p>
                Start your hair journey with MYAVANA and complete your digital hair assessment now!
            </p>
            <div>
                <a asp-action="start" asp-controller="Questionaire">  Start  </a>
            </div>
        </div>
    }


}
else
{
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox ">
                    <div class="selectbox-main-section">
                        <div class="col-md-6 ibox-title text-left w-100 pr-0">
                            <span class="cursive-text-info">The Healthy Hair Care Plan</span>
                            @*<h3 class="main-head-text-info">The Healthy Hair Care Plan</h3>*@
                            @if (hairProfileId.Count == 0)
                            {
                            <select class="form-control w-auto" id="ddlHHCP" onchange="changeHHCP()"
                                    asp-items="@apiClient.GetHHCPList(Model.UserId).Result.Select(a => new SelectListItem() { Text = a.HairProfile, Value = a.HairProfileId.ToString() })"></select>
                            }
                        </div>
                        <div class="col-md-6 addnewbtn">
                            <div class="d-md-flex justify-content-end">
                                <a class="btn dark-btn mr-2" id="share" onclick="openEmailModal()">Share HHCP</a>
                                @if (Model.IsAlreadyShareHHCP)
                                {
                                <a class="btn dark-btn mr-2" id="manage" asp-action="ManageSharedHHCP" asp-controller="HairProfile">Manage Shared HHCP</a>
                            }
                            @if (Model.HasHHCPSharedWithMe)
                            {
                            <a class="btn dark-btn" id="view" asp-action="ViewSharedHHCP" asp-controller="HairProfile">View Shared HHCP</a>
                           }
                            </div>
                            </div>
                    </div>
                    <div id="divPartial">
                        @Html.Partial("_customerHair", Model)
                    </div>

                </div>
            </div>
        </div>
    </div>
}
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModal" aria-hidden="true" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="confirmModalHeader" class="font-bold">Delete FAQ</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <span id="confirmModalText"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelMethod" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmMethod">Save</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal HTML -->
<div class="modal fade" id="emailModal" tabindex="-1" role="dialog" aria-labelledby="emailModalLabel" aria-hidden="true" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="emailModalLabel">Share HHCP</h3>
                <button type="button" class="close" onclick="Clearfields()" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                
            </div>
            <div class="modal-body">
                <p class="share_discription">Enter the email of the person whom you would like to share your Healthy Hair Care Plan (HHCP) with. Note that the person must already have an active MYAVANA account before you can share your HHCP.</p>
                <label>Hair Profile: </label>
                <select class="form-control w-auto" id="ddlShareHHCP" style="width:100%!important"
                        asp-items="@apiClient.GetHHCPList(Model.UserId).Result.Select(a => new SelectListItem() { Text = a.HairProfile, Value=a.HairProfileId.ToString()})"></select>
                <br />
                <label>Email: </label>
                <input type="text" id="emailInput" class="form-control" placeholder="Enter email here" />
                <span id="emailValidationMessage" class="text-danger" style="display: none;"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="Clearfields()" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="shareButton">Share</button>
            </div>
        </div>
    </div>
</div>

<script src="~/js/owl.carousel.min.js"></script>
<script>

    function openEmailModal() {
        $('#emailModal').modal('show');
        $('#emailInput').val('');
    }
    function Clearfields() {
        $('#emailInput').val('');
        $('#emailValidationMessage').hide();
    }
    function validateEmail(email) {
        if (!RegExp(/^[a-zA-Z0-9._-]+@@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/).test(email)) {
            return false;
        }
        return true;
    }
    function checkEmailExists(email, hairProfileId) {

        $.ajax({
            type: 'POST',
            url: '/HairProfile/ShareHHCP',
            data: { email: email, hairProfileId: hairProfileId },
            success: function (response) {
                if (response == "1") {
                    $('#successMessage').text("Your Profile is shared successfully!");
                    $('.alert-success').css("display", "block");
                    $('.alert-success').delay(3000).fadeOut();
                    $('#emailModal').modal('hide');
                    setTimeout(function () { window.location.href = '/HairProfile/CustomerHair'; }, 2000);
                }
                else if (response == "2") {
                    document.getElementById('emailValidationMessage').textContent = 'Entered email does not exist!';
                    $('#emailValidationMessage').show();
                }
                else {
                    $('#failureMessage').text("Something went wrong.Please try later");
                    $('.alert-danger').css("display", "block");
                    $('.alert-danger').delay(3000).fadeOut();
                    $('#emailModal').modal('hide');
                }
            },
            failure: function (response) {
            },
            error: function (response) {
            },
        });

    }
    function shareEmail() {
        var email = $('#emailInput').val();
        $('#emailValidationMessage').hide();
        $('#emailExistMessage').hide();

        if (validateEmail(email) == true) {
            var hairProfileId = $('#ddlShareHHCP').val();
            checkEmailExists(email, hairProfileId);
        } else {
            document.getElementById('emailValidationMessage').textContent = 'Please enter a valid email.';
            $('#emailValidationMessage').show();
        }
    }


    // Bind the share button click event
    $(document).ready(function () {
        $('#shareButton').click(function () {
            shareEmail();
        });

        // Optionally, hide validation message when input changes
        $('#emailInput').on('input', function () {
            $('#emailValidationMessage').hide();
        });
    });

    $(document).ready(function () {
        $(".showHide:first").addClass('active');
        $('.showHideActive:first').addClass('active');
        $('.showHideActive:first').addClass('show');
    });

    function scrolldiv() {
        $('.frame-wrapper').animate({
            scrollTop: 150
        }, 1000);
    }

    function showHide(sender) {
        var id = $(sender).attr('href');
        $('.showHideActive').removeClass('active');
        $('.showHideActive').removeClass('show');
        $('.showHide').removeClass('active');
        $(sender).addClass('active');
        $(id).addClass('active');
        $(id).addClass('show');
    }

    $(document).ready(function () {
        $(".showHide1:first").addClass('active');
        $('.showHide1Active:first').addClass('active');
        $('.showHide1Active:first').addClass('show');
    });

    function showHide1(sender) {
        var id = $(sender).attr('href');
        $('.showHide1Active').removeClass('active');
        $('.showHide1Active').removeClass('show');
        $('.showHide1').removeClass('active');
        $(sender).addClass('active');
        $(id).addClass('active');
        $(id).addClass('show');
        $(id).addClass('show');
    }

    $('.crousalnav').owlCarousel({
        loop: false,
        center: false,
        margin: 20,
        responsiveClass: true,
        responsive: {
            0: {
                items: 1,
                nav: true,
                loop: false
            },
            600: {
                items: 1,
                nav: true,
                loop: false
            },
            1000: {
                items: 3,
                nav: true,
                loop: false
            }
        }
    })
</script>
<script>
    $('.owl-carousel').owlCarousel({
        loop: true,
        margin: 00,
        responsiveClass: true,
        responsive: {
            0: {
                items: 1,
                nav: true,
                loop: true
            },
            600: {
                items: 1,
                nav: true,
                loop: true
            },
            1000: {
                items: 1,
                nav: true,
                loop: true
            }
        }
    })
</script>
<script>
    $('.crousalslide').owlCarousel({
        loop: true,
        margin: 00,
        responsiveClass: true,
        responsive: {
            0: {
                items: 1,
                nav: true,
                loop: true
            },
            600: {
                items: 1,
                nav: true,
                loop: true
            },
            1000: {
                items: 1,
                nav: true,
                loop: true
            }
        }
    })
</script>
<script>
    /**
  * EFECTO PARA FLECHAS EN ACORDEON
  */

    $(document).on('show', '.accordion', function (e) {
        //$('.accordion-heading i').toggleClass(' ');
        $(e.target).prev('.accordion-heading').addClass('accordion-opened');
    });

    $(document).on('hide', '.accordion', function (e) {
        $(this).find('.accordion-heading').not($(e.target)).removeClass('accordion-opened');
        //$('.accordion-heading i').toggleClass('fa-chevron-right fa-chevron-down');
    });
</script>
<script>

    $(document).on('show', '.accordion', function (e) {
        //$('.accordion-heading i').toggleClass(' ');
        $(e.target).prev('.accordion-heading').addClass('accordion-opened');
    });

    $(document).on('hide', '.accordion', function (e) {
        $(this).find('.accordion-heading').not($(e.target)).removeClass('accordion-opened');
        //$('.accordion-heading i').toggleClass('fa-chevron-right fa-chevron-down');
    });


</script>
<script>
    $(document).ready(function () {
        $(".showHide:first").addClass('active');
        $('.showHideActive:first').addClass('active');
        $('.showHideActive:first').addClass('show');
        $(".showHide2:first").addClass('active');
        $('.showHide2Active:first').addClass('active');
        $('.showHide2Active:first').addClass('show');
        $(".showHide1:first").addClass('active');
        $('.showHide1Active:first').addClass('active');
        $('.showHide1Active:first').addClass('show');
    });
    $('.demo').nailthumb({
        imageCustomFinder: function (el) {
            var image = $('<img />').attr('src', el.attr('href').replace('/full/', '/small/')).css('display', 'none');
            image.attr('alt', el.attr('title'));
            el.append(image);
            return image;
        },
        titleAttr: 'alt'
    });



    jQuery.fn.load = function (callback) {
        $(window).on("load", function () {
            Shadowbox.init();
            $('.demo').css("display", "block");
        })

    };
    function GetHairKit() {
        window.open("https://www.test.com/pages/scientific-intelligence");
    }
    function showHide1(sender) {
        var id = $(sender).attr('href');
        $('.showHide1Active').removeClass('active');
        $('.showHide1Active').removeClass('show');
        $('.showHide1').removeClass('active');
        $(sender).addClass('active');
        $(id).addClass('active');
        $(id).addClass('show');
    }
    function showHide(sender) {
        var id = $(sender).attr('href');
        $('.showHide2Active').removeClass('active');
        $('.showHide2Active').removeClass('show');
        $('.showHide2').removeClass('active');
        $(sender).addClass('active');
        $(id).addClass('active');
        $(id).addClass('show');
    }
    function changeHHCP() {
        //$('#divPartial').load('/HairProfile/GetHHCP/' + $('#ddlHHCP').val());
        $('.preloader').css('display', 'block');
        $.ajax({
            type: "GET",
            url: "/HairProfile/GetHHCP/" + $('#ddlHHCP').val(),
            success: function (response) {
                $('.preloader').css('display', 'none');
                console.log(response)
                $('#divPartial').html(response);
                $('.demo').nailthumb({
                    imageCustomFinder: function (el) {
                        var image = $('<img />').attr('src', el.attr('href').replace('/full/', '/small/')).css('display', 'none');
                        image.attr('alt', el.attr('title'));
                        el.append(image);
                        return image;
                    },
                    titleAttr: 'alt'
                });
                $('.demo').css("display", "block");
            },
            failure: function (response) {
            },
            error: function (response) {
            },
        });
    }
    function GetHHCPStrands(hairprofileid) {
        if ($('#divPartialHairAnalysis').hasClass('loadedonce')) {
            return false;
        }
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const userId = urlParams.get('id')

        if (hairprofileid == null) {
            hairprofileid = $('#ddlHHCP').val();
        }
        $('.preloader').css('display', 'block');
        $.ajax({
            type: "GET",
            url: "/HairProfile/GetHHCPStrands?id=" + hairprofileid,
            success: function (response) {
                $('.preloader').css('display', 'none');

                $('#divPartialHairAnalysis').html(response);
                $('#divPartialHairAnalysis').addClass('loadedonce');
            },
            failure: function (response) {
            },
            error: function (response) {
            },
        });


    }
    function ShareHHCP(event) {

        var ingedientsEntityId = $(event).attr('data-code');

        $('#confirmModalHeader').text('Delete');
        $('#confirmModalText').text('Are you sure you want to delete?');
        $('#confirmMethod').removeAttr('onclick');
        $('#confirmMethod').text('Delete');
        $('#confirmModal').modal('show');
        $("#confirmMethod").prop("onclick", null).off("click");
        $("#confirmMethod").click(function () {
            DeleteIngredient(ingedientsEntityId);
        });
    }
    document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const view = urlParams.get('View');

        if (view === 'shared') {
            document.getElementById('share').style.display = 'none';
            document.getElementById('manage').style.display = 'none';
            document.getElementById('view').style.display = 'none';
        }
    });
</script>
